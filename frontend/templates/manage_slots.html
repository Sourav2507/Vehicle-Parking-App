{% extends "admin.html" %} {% block admin_head %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/manage_slots.css') }}"
/>
{% endblock %} {% block admin_content %}
<div class="container py-4" id="manage-slots-app">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-dark">Parking Slots</h2>
    <!-- Button switches view -->
    <button
      class="btn btn-outline-primary"
      @click="showAddForm = true"
      v-if="!showAddForm"
    >
      Add a New Slot
    </button>
    <button class="btn btn-secondary" @click="cancelAdd" v-if="showAddForm">
      Cancel Adding
    </button>
  </div>

  <!-- Show form if adding -->
  <div
    v-if="showAddForm"
    class="card p-4 shadow-sm"
    style="max-width: 600px; margin: auto"
  >
    <h5 class="mb-4">Add New Parking Slot</h5>
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Name</label>
        <input type="text" v-model="newSlot.name" class="form-control" />
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Address</label>
        <input type="text" v-model="newSlot.address" class="form-control" />
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Capacity</label>
        <input
          type="number"
          v-model.number="newSlot.capacity"
          class="form-control"
          min="1"
        />
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Price per Hour(INR)</label>
        <input
          type="number"
          v-model.number="newSlot.price"
          class="form-control"
          min="0"
        />
      </div>
    </div>
    <div class="d-flex justify-content-end gap-2">
      <button class="btn btn-secondary" @click="cancelAdd">Cancel</button>
      <button class="btn btn-primary" @click="addSlot">Add Slot</button>
    </div>
  </div>

  <!-- Show table if not adding -->
  <div v-else>
    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th>Slot ID</th>
            <th>Name</th>
            <th>Address</th>
            <th>Capacity</th>
            <th>Occupied</th>
            <th>Price(INR)</th>
            <th>Availability</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="slot in slots" :key="slot.id">
            <td>#00${ slot.id }</td>
            <td>${ slot.name }</td>
            <td>${ slot.address }</td>
            <td>${ slot.capacity }</td>
            <td>${ slot.occupied }</td>
            <td>${ slot.price }</td>
            <td class="text-center">
              <button
                class="btn"
                :class="slot.active ? 'btn-success' : 'btn-danger'"
                @click="toggleActive(slot)"
              >
                ${ slot.active ? 'Available' : 'Unavailable' }
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="{{ url_for('static', filename='js/manage_slots.js') }}"></script>
{% endblock %}
